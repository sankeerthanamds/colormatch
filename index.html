<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Color Picker</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic appeal and responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        /* Custom file input appearance */
        input[type="file"] {
            display: none;
        }
        .custom-file-upload {
            border: 2px dashed #ffb3b3;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .custom-file-upload:hover {
            background-color: #fffafa;
            border-color: #ffc8d9;
        }
        /* Canvas styling for responsive display and interaction */
        #imageCanvas {
            width: 100%;
            height: auto;
            max-height: 80vh; /* Prevents excessively tall images on small screens */
            cursor: crosshair; /* Indicates it's interactive */
            display: block;
        }
    </style>
</head>
<body>
    <div id="app" class="container rounded-xl p-6 md:p-8 space-y-6">
        <h1 class="text-3xl font-bold text-center text-gray-800">
            Pixel Color Picker <span class="text-pink-500">üç¨</span>
        </h1>
        <p class="text-center text-gray-500">
            Upload an image, then **click on any pixel** to find its closest match from the gum palette.
        </p>
        
        <!-- NEW IMPORTANT NOTE -->
        <div class="p-3 bg-yellow-50 border border-yellow-200 text-sm text-yellow-800 rounded-lg">
            <p class="font-medium">‚ö†Ô∏è Important Note:</p>
            <p>This tool is specialized for matching colors against the limited "gum shade" palette (G1-G5). Results are optimized for these specific color tones and may not provide the closest match for general web colors.</p>
        </div>

        <!-- Image Upload Area -->
        <label for="fileInput" class="custom-file-upload rounded-lg">
            <div class="flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-pink-500 mb-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                </svg>
                <span class="text-pink-600 font-semibold">Click to Upload Image</span>
                <span class="text-sm text-gray-500 mt-1">PNG, JPG, or JPEG</span>
            </div>
        </label>
        <input type="file" id="fileInput" accept="image/*">

        <!-- Image Preview and Interaction Area -->
        <div id="previewArea" class="hidden">
            <h2 class="text-xl font-semibold mb-3 text-gray-700" id="previewTitle">Image Preview - Click on a point!</h2>
            <!-- The canvas is now used for both display and interaction -->
            <canvas id="imageCanvas" class="rounded-lg shadow-md border border-gray-100"></canvas>
        </div>

        <!-- Results Area - Displays the picked pixel color and the closest match -->
        <div id="results" class="hidden pt-4 border-t mt-6 border-gray-100 space-y-4">
            <h2 class="text-xl font-semibold text-gray-700">Selected Pixel Results</h2>

            <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                <h3 class="text-lg font-medium text-gray-600 mb-2">Picked Pixel Color:</h3>
                <div id="averageColorDisplay" class="h-12 w-full rounded-md border border-gray-200" style="background-color: #ccc;"></div>
                <!-- This displays the generated common color name (e.g., "Dark Red") -->
                <p id="averageColorText" class="text-center mt-2 font-mono text-xl font-semibold text-gray-800">Picked Color Value</p>
            </div>

            <div class="bg-pink-50 p-4 rounded-lg shadow-inner border-2 border-pink-200">
                <h3 class="text-lg font-bold text-pink-700 mb-2">Closest Palette Match:</h3>
                <div id="matchColorDisplay" class="h-16 w-full rounded-lg shadow-lg transform transition-all duration-300 hover:scale-[1.02]" style="background-color: #fffafa;"></div>
                <!-- Displays the specific gum shade name (e.g., "G1 Rose/Dusky Pink") -->
                <p id="matchColorText" class="text-center mt-3 text-2xl font-extrabold text-pink-600">G1 Rose/Dusky Pink</p>
            </div>
        </div>

        <!-- Error/Loading Message Area -->
        <div id="messageArea" class="text-center text-sm text-red-500 hidden p-3 rounded-lg bg-red-100"></div>

    </div>

    <script>
        // --- Configuration and Utilities ---

        // Palette updated to use the specific G codes provided by the user.
        const PALETTE = [
            { hex: "#B76E79", name: "G1 Rose/Dusky Pink" },         // Muted Rose
            { hex: "#FFB6A0", name: "G2 Nectarine/Orange Pink" },    // Peachy Pink
            { hex: "#FF7F7F", name: "G3 Pink Grapefruit/Pink" },     // Saturated Pink/Coral
            { hex: "#65000B", name: "G4 Rose Wood/Brown Red" },      // Deep Reddish Brown
            { hex: "#3C000B", name: "G5 Cherry Brown/Black-Red" }    // Very Dark Black-Red
        ];

        // Expanded list of named colors for approximating the clicked pixel's hue.
        // This list now includes a wide range of distinct colors across the RGB spectrum 
        // (including Dark, Light, and Muted variants) to provide more accurate descriptive naming
        // for all hues (Red, Green, Blue, Yellow, etc.).
        const WEB_COLORS = [
            // Primary & Pure Hues
            { r: 255, g: 0, b: 0, name: "Red" },
            { r: 0, g: 128, b: 0, name: "Green" },
            { r: 0, g: 0, b: 255, name: "Blue" },
            { r: 255, g: 255, b: 0, name: "Yellow" },
            { r: 255, g: 165, b: 0, name: "Orange" },
            { r: 128, g: 0, b: 128, name: "Purple" },
            { r: 255, g: 0, b: 255, name: "Magenta" },
            { r: 0, g: 255, b: 255, name: "Cyan" },

            // Red/Brown/Pink Variations
            { r: 128, g: 0, b: 0, name: "Maroon" },
            { r: 165, g: 42, b: 42, name: "Brown" },
            { r: 220, g: 20, b: 60, name: "Crimson" },
            { r: 255, g: 192, b: 203, name: "Pink" },
            { r: 219, g: 112, b: 147, name: "Deep Pink" },
            
            // Green/Yellow Variations
            { r: 85, g: 107, b: 47, name: "Olive" }, // Darker, earthier green
            { r: 0, g: 100, b: 0, name: "Dark Green" },
            { r: 50, g: 205, b: 50, name: "Lime Green" },
            { r: 64, g: 224, b: 208, name: "Turquoise" }, // Blue-Green
            { r: 0, g: 128, b: 128, name: "Teal" }, // Dark Cyan

            // Blue/Purple Variations
            { r: 75, g: 0, b: 130, name: "Indigo" }, // Dark Blue/Purple
            { r: 238, g: 130, b: 238, name: "Violet" }, // Lighter Purple
            { r: 70, g: 130, b: 180, name: "Steel Blue" },
            { r: 173, g: 216, b: 230, name: "Light Blue" },
            
            // Neutrals
            { r: 255, g: 255, b: 255, name: "White" },
            { r: 0, g: 0, b: 0, name: "Black" },
            { r: 192, g: 192, b: 192, name: "Silver" }, // Light Gray
            { r: 128, g: 128, b: 128, name: "Gray" }, // Medium Gray
            { r: 105, g: 105, b: 105, name: "Dim Gray" } // Darker Gray
        ];
        
        const fileInput = document.getElementById('fileInput');
        const imageCanvas = document.getElementById('imageCanvas');
        const previewArea = document.getElementById('previewArea');
        const resultsArea = document.getElementById('results');
        const averageColorDisplay = document.getElementById('averageColorDisplay');
        const averageColorText = document.getElementById('averageColorText');
        const matchColorDisplay = document.getElementById('matchColorDisplay');
        const matchColorText = document.getElementById('matchColorText');
        const messageArea = document.getElementById('messageArea');

        /**
         * Converts a hex color string to an RGB object.
         * @param {string} hex - The hex color string (e.g., "#ffb3b3").
         * @returns {Object} An object {r, g, b}.
         */
        function hexToRgb(hex) {
            // Remove '#' if present
            const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function(m, r, g, b) {
                return r + r + g + g + b + b;
            });

            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        /**
         * Converts an RGB object to a hex color string.
         * @param {Object} rgb - The RGB object {r, g, b}.
         * @returns {string} The hex color string (e.g., "#FFB3B3").
         */
        function rgbToHex(rgb) {
            return "#" + ((1 << 24) + (rgb.r << 16) + (rgb.g << 8) + rgb.b).toString(16).slice(1).toUpperCase();
        }

        /**
         * Calculates the Euclidean distance between two RGB colors.
         * This is used to determine how "close" two colors are.
         * @param {Object} rgb1 - First RGB color {r, g, b}.
         * @param {Object} rgb2 - Second RGB color {r, g, b}.
         * @returns {number} The distance value.
         */
        function rgbDistance(rgb1, rgb2) {
            const dr = rgb1.r - rgb2.r;
            const dg = rgb1.g - rgb2.g;
            const db = rgb1.b - rgb2.b;
            // Standard Euclidean distance
            return Math.sqrt(dr * dr + dg * dg + db * db);
        }

        /**
         * Finds the closest general color name for the picked color.
         * This provides the descriptive label for the picked pixel.
         * @param {Object} pickedRgb - The RGB color to name.
         * @returns {string} The descriptive color name (e.g., "Dark Blue").
         */
        function getClosestWebColorName(pickedRgb) {
            let closestName = "Unknown Color";
            let minDistance = Infinity;

            for (const colorItem of WEB_COLORS) {
                const distance = rgbDistance(pickedRgb, colorItem);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestName = colorItem.name;
                }
            }

            // Apply light/dark prefix for better description
            // Calculate perceived brightness (luminance)
            const brightness = (pickedRgb.r * 299 + pickedRgb.g * 587 + pickedRgb.b * 114) / 1000;
            
            // Check if the color is mostly achromatic (gray scale)
            const isAchromatic = Math.abs(pickedRgb.r - pickedRgb.g) < 20 && 
                                 Math.abs(pickedRgb.r - pickedRgb.b) < 20 && 
                                 Math.abs(pickedRgb.g - pickedRgb.b) < 20;

            if (isAchromatic) {
                if (brightness < 40) return "Black";
                if (brightness > 220) return "White";
                if (brightness < 100) return "Dark Gray";
                return "Light Gray";
            }
            
            // Apply modifiers for chromatic colors
            if (brightness < 60) {
                return "Very Dark " + closestName;
            } else if (brightness < 120) {
                return "Dark " + closestName;
            } else if (brightness > 200) {
                return "Pale " + closestName;
            } else if (brightness > 160) {
                return "Light " + closestName;
            }
            
            return closestName;
        }


        /**
         * Finds the closest color in the specific gum palette to the pixel's color.
         * @param {Object} pickedRgb - The RGB color to match against.
         * @param {Array<Object>} palette - Array of color objects {hex, name}.
         * @returns {Object} The closest color object {hex, name} and its distance.
         */
        function findClosestColor(pickedRgb, palette) {
            let closestMatch = palette[0];
            let minDistance = Infinity;

            for (const colorItem of palette) {
                const paletteRgb = hexToRgb(colorItem.hex);
                if (!paletteRgb) continue;

                const distance = rgbDistance(pickedRgb, paletteRgb);

                if (distance < minDistance) {
                    minDistance = distance;
                    closestMatch = colorItem; // Store the entire object
                }
            }

            return { hex: closestMatch.hex, name: closestMatch.name, distance: minDistance };
        }

        /**
         * Displays a message or error to the user.
         * @param {string} message - The message text.
         * @param {boolean} isError - If true, treats it as an error message.
         */
        function showMessage(message, isError = false) {
            messageArea.textContent = message;
            messageArea.classList.toggle('hidden', !message);
            messageArea.classList.toggle('bg-red-100', isError);
            messageArea.classList.toggle('text-red-500', isError);
            messageArea.classList.toggle('bg-blue-100', !isError);
            messageArea.classList.toggle('text-blue-500', !isError);
            if (message && !isError) {
                // Keep the results hidden if it's just an instruction message
                resultsArea.classList.add('hidden');
            }
        }

        /**
         * Handles the click event on the canvas to select a pixel color.
         * @param {Event} event - The click event.
         */
        function handleCanvasClick(event) {
            const rect = imageCanvas.getBoundingClientRect();
            
            // Calculate scale factors to map click coordinates (visual size) 
            // back to the canvas's internal pixel resolution (native size).
            const scaleX = imageCanvas.width / rect.width;
            const scaleY = imageCanvas.height / rect.height;

            const x = Math.floor((event.clientX - rect.left) * scaleX);
            const y = Math.floor((event.clientY - rect.top) * scaleY);

            const ctx = imageCanvas.getContext('2d');
            
            try {
                // Get the data of the single pixel at (x, y)
                const pixelData = ctx.getImageData(x, y, 1, 1).data;
                
                // RGB of the picked pixel
                const pickedRgb = {
                    r: pixelData[0],
                    g: pixelData[1],
                    b: pixelData[2]
                };
                const pickedHex = rgbToHex(pickedRgb);
                
                // --- Get the common name for the picked pixel color ---
                const pickedColorName = getClosestWebColorName(pickedRgb);
                // -----------------------------------------------------

                // Find Closest Match (now returns name and hex)
                const match = findClosestColor(pickedRgb, PALETTE);

                // Update Results UI
                averageColorDisplay.style.backgroundColor = pickedHex;
                // Display the generated common name for the picked color
                averageColorText.textContent = pickedColorName;
                
                matchColorDisplay.style.backgroundColor = match.hex;
                // Update text to show ONLY the specific gum shade name
                matchColorText.innerHTML = `<span class="font-extrabold text-2xl">${match.name}</span>`;

                resultsArea.classList.remove('hidden');
                showMessage(""); // Clear any previous messages
                
            } catch (error) {
                console.error("Error picking pixel color:", error);
                showMessage("Could not pick pixel color. Please ensure the image is loaded correctly.", true);
            }
        }

        /**
         * Main function to load and process the uploaded image.
         */
        function loadAndProcessImage(file) {
            if (!file || !file.type.startsWith('image/')) {
                showMessage("Please select a valid image file.", true);
                return;
            }

            showMessage("Loading image...", false);
            resultsArea.classList.add('hidden');
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    try {
                        // 1. Set Canvas size to the image's native resolution 
                        // (important for accurate pixel picking)
                        imageCanvas.width = img.width;
                        imageCanvas.height = img.height;

                        const context = imageCanvas.getContext('2d');
                        // 2. Draw the full image onto the canvas
                        context.drawImage(img, 0, 0);

                        // 3. Display Canvas Area and Instructions
                        previewArea.classList.remove('hidden');
                        showMessage("Image loaded! Click anywhere on the image to pick a color.", false);

                    } catch (e) {
                        console.error("Error during image loading:", e);
                        showMessage("An unexpected error occurred during image preparation.", true);
                    }
                };
                img.onerror = function() {
                    showMessage("Could not load the image. File might be corrupted.", true);
                };
                img.src = event.target.result;
            };

            reader.onerror = function() {
                showMessage("Failed to read the file.", true);
            };

            reader.readAsDataURL(file);
        }

        // --- Event Listeners ---
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                loadAndProcessImage(e.target.files[0]);
            }
        });

        // Add the click listener to the canvas for pixel picking
        imageCanvas.addEventListener('click', handleCanvasClick);

        // Initialize with a simple message
        window.onload = () => {
             showMessage("Upload an image to start the color matching process.", false);
        };
    </script>
</body>
</html>
